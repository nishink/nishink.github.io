!function o(s,a,u){function h(e,t){if(!a[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return h(s[e][1][t]||t)},r,r.exports,o,s,a,u)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)h(u[t]);return h}({1:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function n(){}n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],2:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,e,d){var a=/%[sdj%]/g;d.format=function(t){if(!b(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(u(arguments[n]));return e.join(" ")}n=1;for(var i=arguments,r=i.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(r<=n)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return t}}),s=i[n];n<r;s=i[++n])x(s)||!h(s)?o+=" "+s:o+=" "+u(s);return o},d.deprecate=function(t,e){if(S(global.process))return function(){return d.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),n=!0}return t.apply(this,arguments)}};var i,r={};function u(t,e){var n={seen:[],stylize:s};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),g(e)?n.showHidden=e:e&&d._extend(n,e),S(n.showHidden)&&(n.showHidden=!1),S(n.depth)&&(n.depth=2),S(n.colors)&&(n.colors=!1),S(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),f(n,t,n.depth)}function o(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function s(t,e){return t}function f(e,n,i){if(e.customInspect&&n&&T(n.inspect)&&n.inspect!==d.inspect&&(!n.constructor||n.constructor.prototype!==n)){var t=n.inspect(i,e);return b(t)||(t=f(e,t,i)),t}var r=function(t,e){if(S(e))return t.stylize("undefined","undefined");if(b(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(w(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(x(e))return t.stylize("null","null")}(e,n);if(r)return r;var o,s=Object.keys(n),a=(o={},s.forEach(function(t,e){o[t]=!0}),o);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),A(n)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return y(n);if(0===s.length){if(T(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(_(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(A(n))return y(n)}var h,l="",c=!1,p=["{","}"];m(n)&&(c=!0,p=["[","]"]),T(n)&&(l=" [Function"+(n.name?": "+n.name:"")+"]");return _(n)&&(l=" "+RegExp.prototype.toString.call(n)),E(n)&&(l=" "+Date.prototype.toUTCString.call(n)),A(n)&&(l=" "+y(n)),0!==s.length||c&&0!=n.length?i<0?_(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),h=c?function(e,n,i,r,t){for(var o=[],s=0,a=n.length;s<a;++s)O(n,String(s))?o.push(v(e,n,i,r,String(s),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(v(e,n,i,r,t,!0))}),o}(e,n,i,a,s):s.map(function(t){return v(e,n,i,a,t,c)}),e.seen.pop(),function(t,e,n){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(h,l,p)):p[0]+l+p[1]}function y(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,e,n,i,r,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),O(i,r)||(s="["+r+"]"),a||(t.seen.indexOf(u.value)<0?-1<(a=x(n)?f(t,u.value,null):f(t,u.value,n-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),S(s)){if(o&&r.match(/^\d+$/))return a;s=(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function m(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function x(t){return null===t}function w(t){return"number"==typeof t}function b(t){return"string"==typeof t}function S(t){return void 0===t}function _(t){return h(t)&&"[object RegExp]"===n(t)}function h(t){return"object"==typeof t&&null!==t}function E(t){return h(t)&&"[object Date]"===n(t)}function A(t){return h(t)&&("[object Error]"===n(t)||t instanceof Error)}function T(t){return"function"==typeof t}function n(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}d.debuglog=function(e){if(S(i)&&(i=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!r[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var n=process.pid;r[e]=function(){var t=d.format.apply(d,arguments);console.error("%s %d: %s",e,n,t)}}else r[e]=function(){};return r[e]},(d.inspect=u).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},d.isArray=m,d.isBoolean=g,d.isNull=x,d.isNullOrUndefined=function(t){return null==t},d.isNumber=w,d.isString=b,d.isSymbol=function(t){return"symbol"==typeof t},d.isUndefined=S,d.isRegExp=_,d.isObject=h,d.isDate=E,d.isError=A,d.isFunction=T,d.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},d.isBuffer=t("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}d.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],e].join(" ")),d.format.apply(d,arguments))},d.inherits=t("inherits"),d._extend=function(t,e){if(!e||!h(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,e,n){"use strict";function i(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=i).prototype.setVolume=function(t,e){var n=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),n&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},i.prototype.setMute=function(t){this.setVolume(null,t)},i.prototype.playLoopSound=function(t,n,i,r,o,s){var a=this.audioManager,u=a.settings.defaultFade,e=a.settings.crossFading,h=this.loopSound,l=h&&h.id;if(n=Math.max(0,Math.min(1,n||1)),this.loopId=t,this.loopVol=n,!a.muted&&!this.muted){if(t===l&&h)return h.play(n*this.volume,i,r),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(h=null,!this.nextLoop||this.nextLoop.id!==t){var c=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=a.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return c.nextLoop.unload(),void(c.nextLoop=null);p(c.loopSound),f()})):(this.nextLoop=a.createSound(t,this.id),p(this.loopSound,f))}}function p(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return a.freeSound(t),t=null,e&&e()})}function d(){var e=c.loopSound=c.nextLoop;c.nextLoop=null,e&&(e.setLoop(!0,o,s),e.fade=u,e.load(function(t){if(t)return e.unload(),void(c.loopSound=null);e.play(n*c.volume,i,r)}))}function f(){c.loopSound=null,window.setTimeout(d,0)}}},{}],5:[function(t,e,n){"use strict";var i=window.AudioContext||window.webkitAudioContext,r=t("./OrderedList"),o=t("./SoundBuffered.js"),s=t("./SoundGroup.js"),a=t("./AudioChannel.js"),u=t("./ISound.js");function h(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new r(function(){return 1}),this.soundGroupArchive=new r(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var n=t[e];this.channels[n]=new a(n)}u.prototype.audioManager=this,s.prototype.audioManager=this,a.prototype.audioManager=this}i||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),o=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),o=u)),e.exports=h,e.exports.ISound=u,h.prototype.init=function(){if(!this.audioContext&&i)for(var t in this.audioContext=new i,o.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},h.prototype.getEmptySound=function(t,e){var n,i=this.settings.getSoundConstructor(t,e);return i?n=new i:(0<this.freeSoundPool.length?(n=this.freeSoundPool.pop()).init():n=new o,n)},h.prototype.setup=function(t){for(var e in t){var n=t[e];this.setVolume(e,n.volume,n.muted)}},h.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new a(t))},h.prototype.setVolume=function(t,e,n){var i=this.channels[t];i&&i.setVolume(e,n)},h.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var n=this.channels[e];if(n.loopSound)if(t)n.loopSound.stop();else{var i=n.muted;n.muted=!0,n.setVolume(null,i)}}},h.prototype.loadSound=function(t,e){var n=this.createSound(t);return n.load(e),n},h.prototype.createSound=function(t,e){var n=this.getSound(t);return n||((n=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),n)},h.prototype.createSoundPermanent=function(t,e){var n=this.getSound(t);if(n)return n;var i=this.settings.getSoundConstructor(e,t)||o;return(n=this.permanentSounds[t]=new i).setId(t),n},h.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},h.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},h.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof o&&this.freeSoundPool.push(t)},h.prototype.playLoopSound=function(t,e,n,i,r,o,s){var a=this.channels[t];if(!a)return console.warn('Channel id "'+t+'" does not exist.');a.playLoopSound(e,n,i,r,o,s)},h.prototype.stopLoopSound=function(t){var e=this,n=this.channels[t];if(!n)return console.warn('Channel id "'+t+'" does not exist.');var i=n.loopSound;n.loopId=null,i&&i.stop(function(){e.freeSound(i),n.loopSound=null})},h.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},h.prototype.release=function(){var t,e,n,i=this.settings.maxSoundGroup,r=this.settings.maxUsedMemory,o={};for(t in this.channels){var s=this.channels[t];s.loopSound&&(o[s.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)o[t]||((n=this.soundsById[t]).poolRef=this.soundArchive.add(n),this.soundArchiveById[t]=n,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();i<a&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--a;for(;this.usedMemory>r&&(n=this.soundArchive.popFirst());)n.poolRef=null,delete this.soundArchiveById[n.id],this.freeSound(n)},h.prototype.playSound=function(t,e,n,i,r){if(!this.muted){var o=this.channels[t];if(!o.muted){var s=this.getSound(e);n=n||1,(s=s||this.createSound(e,t)).play(o.volume*n,i,r)}}},h.prototype.playSoundGroup=function(t,e,n,i,r){if(!this.muted){var o=this.channels[t];if(o&&!o.muted){var s=this.getSoundGroup(e);if(!s)return console.warn('SoundGroup "'+e+'" does not exist.');n=n||1,s.play(n*o.volume,i,r)}}},h.prototype.createSoundGroup=function(t,e,n){if(!this.getSoundGroup(t)){var i=new s(t,e.id,e.vol,e.pitch,n);this.soundGroupsById[t]=i}},h.prototype.createSoundGroups=function(t,e){var n=void 0!==e&&this.channels[e].muted;for(var i in t)this.createSoundGroup(i,t[i],n)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,e,n){"use strict";function i(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=i).prototype.setId=function(t){this.id=t,this._loaded=!1},i.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},i.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var n=0;n<this._onLoadQueuedCallback.length;n++)this._onLoadQueuedCallback[n](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},i.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},i.prototype.play=function(t,e,n){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(n):this._play(n)},i.prototype.init=function(){},i.prototype.setVolume=function(t){this.volume=t},i.prototype.setPan=function(t){this.pan=t},i.prototype.setLoop=function(t){this.loop=t},i.prototype.setPitch=function(t){this.pitch=t},i.prototype._updatePlayPitch=function(t){},i.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},i.prototype.stop=function(t){return this.playing=!1,t&&t()},i.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},i.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,e,n){"use strict";function o(t,e,n,i){this.object=t,this.previous=e,this.next=n,this.container=i}function i(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}i.prototype.add=function(t){var e=new o(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var n=this.cmpFunc(t,this.first.object);if(n<0)return e.next=this.first,this.first.previous=e,this.first=e;var i,r=this.cmpFunc(t,this.last.object);if(0<=r)return e.previous=this.last,this.last.next=e,this.last=e;if(n+r<0){for(i=this.first.next;0<=this.cmpFunc(t,i.object);)i=i.next;e.next=i,e.previous=i.previous,e.previous.next=e,i.previous=e}else{for(i=this.last.previous;this.cmpFunc(t,i.object)<0;)i=i.previous;e.previous=i,e.next=i.next,e.next.previous=e,i.next=e}return e},i.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},i.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},i.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},i.prototype.possess=function(t){return t&&t.container===this},i.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},i.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},i.prototype.getFirst=function(){return this.first&&this.first.object},i.prototype.getLast=function(){return this.last&&this.last.object},i.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},i.prototype.getCount=function(){return this.count},i.prototype.forEach=function(t,e){for(var n=this.first;n;n=n.next)t(n.object,e)},i.prototype.forEachReverse=function(t,e){for(var n=this.last;n;n=n.previous)t(n.object,e)},i.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,n=t.next,i=t.object;for(null===n?this.last=e:n.previous=e,null===e?this.first=n:e.next=n;null!==e&&this.cmpFunc(i,e.object)<0;)e=(n=e).previous;for(;null!==n&&0<=this.cmpFunc(i,n.object);)n=(e=n).next;return null===(t.next=n)?this.last=t:n.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=i},{}],8:[function(t,e,n){"use strict";var i=t("util").inherits,r=t("./ISound.js"),o={playAudioWhenScreenIsLocked:!1};function s(){r.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}i(s,r),(e.exports=s).prototype.setVolume=function(t){this.volume=this._audio.volume=t},s.prototype.setLoop=function(t){this.loop=this._audio.loop=t},s.prototype._load=function(){var e=this;function n(t){e._finalizeLoad(t)}function i(){this.removeEventListener("canplaythrough",i),this.removeEventListener("error",r),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function r(t){this.removeEventListener("canplaythrough",i),this.removeEventListener("error",r),n(t)}function o(t){e._loading=!0,e._audio.addEventListener("canplaythrough",i),e._audio.addEventListener("error",r),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,s=this.audioManager.settings.audioPath;if(2<t.length)t(s,this.id,function(t,e){if(t)return n(t);o(e)});else try{var a=t(s,this.id);if(!a)return n("emptyUri");o(a)}catch(t){n(t)}},s.prototype.unload=function(){r.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},s.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(o),this.playing=!0},s.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,e,n){"use strict";var i=t("util").inherits,r=t("./ISound.js"),o=1e-6;function s(){r.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}i(s,r),(e.exports=s).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,n=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),n.connect(t),t.connect(e.destination),n.gain.value=0,this.sourceConnector=n,this.gain=n.gain,this.panNode=t,this._audioNodeReady=!0}},s.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,n=this.sourceConnector;n.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(n),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},s.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,n=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<n)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},s.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=o);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||o,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},s.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},s.prototype.setLoop=function(t,e,n){this.loop=!!t,this._loopStart=e||0,this._loopEnd=n||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},s.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},s.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},s.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},s.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var n=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(n),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||o,n),this.source.playbackRate.linearRampToValueAtTime(e,n+t)}else this.source.playbackRate.value=e}},s.prototype._load=function(){var n=this;function i(t){n._finalizeLoad(t)}function r(t){n.buffer=t,n.usedMemory=t.duration,n.audioManager.usedMemory+=t.duration,n._finalizeLoad(null)}function o(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?i("xhrError:"+e.status):void(n.audioContext?n.audioContext.decodeAudioData(e.response,r,i):(n.rawAudioData=e.response,n._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return i(t);o(e)});else try{var s=t(e,this.id);if(!s)return i("emptyUri");o(s)}catch(t){i(t)}},s.prototype.unload=function(){r.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},s.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||o,e),this.gain.linearRampToValueAtTime(this.volume||o,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var n=this.source=this.audioContext.createBufferSource();n.connect(this.sourceConnector);var i=this;n.onended=function(){i.playing=!1,n.onended=null,i.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),n.loop=this.loop,n.buffer=this.buffer,this._setLoopPoints(),n.start(0)}else this._playTriggered=Date.now()},s.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},s.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,n=this.audioContext.currentTime;return this.gain.cancelScheduledValues(n),this.gain.setValueAtTime(this.gain.value||o,n),this.gain.linearRampToValueAtTime(o,n+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,e,n){"use strict";function i(t,e,n,i,r){this.id=t,this.soundIds=e,this.volumes=n||[],this.pitches=i||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),r||this._createSounds()}(e.exports=i).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},i.prototype.play=function(t,e,n){if(0!==this.soundIds.length){this._ready||this._createSounds();var i=this.soundIds[this.soundIndex++],r=this.audioManager.getSound(i);if(!r)return console.warn("[Sound Group: "+this.id+"] sound id "+i+"  cannot be played.");t=t||1,n=n||0,t*=this.volumes[this.volIndex++],n+=this.pitches[this.pitchIndex++],r.play(t,e,n),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},i.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],11:[function(t,e,n){"use strict";var s=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function i(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=i).prototype._setRGB=function(t,e,n){this.r=t,this.g=e,this.b=n},i.prototype.fromPixel=function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return this.string="rgb("+n+","+i+","+r+")",this._setRGB(n,i,r),this},i.prototype.fromString=function(t){var e,n,i,r=(this.string=t).match(s);if(r)e=~~r[1],n=~~r[2],i=~~r[3],this._setRGB(e,n,i);else{var o="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(o>>16,o>>8&255,255&o)}return this},i.prototype.fromRGB=function(t,e,n){return this._setRGB(t,e,n),this.string="rgb("+t+","+e+","+n+")",this},i.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],12:[function(t,e,n){"use strict";var i=t("./index"),r=t("../domUtils/createCanvas"),h=8,l=8,y=Math.PI/2;i.setTileSize=function(t,e){h=~~t,l=~~e},i.prototype._init=function(){this.canvas=r(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},i.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},i.prototype.sprite=function(t,e,n,i,r,o){var s=h*(t%16),a=l*~~(t/16),u=this.ctx;return e=e||0,n=n||0,e=~~Math.round(e-this.camera.x),n=~~Math.round(n-this.camera.y),i||r||o?(u.save(),i&&(u.scale(-1,1),e=-e-h),r&&(u.scale(1,-1),n=-n-l),o?(u.translate(e+l,n),u.rotate(y)):u.translate(e,n),u.drawImage(this.tilesheet,this.ox+s,this.oy+a,h,l,0,0,h,l),u.restore()):u.drawImage(this.tilesheet,this.ox+s,this.oy+a,h,l,e,n,h,l),this},i.prototype.draw=function(t,e,n,i,r,o){var s=i||r||o;if(t._isSprite){var a=t;t=a.img;var u=a.x,h=a.y,l=a.width,c=a.height,p=~~Math.round((e||0)-this.camera.x),d=~~Math.round((n||0)-this.camera.y);return s?((f=this.ctx).save(),o?(i&&(f.scale(-1,1),p*=-1,p-=c),r&&(f.scale(1,-1),d*=-1,d-=l),f.translate(p+c,d),f.rotate(y)):(i&&(f.scale(-1,1),p*=-1,p-=l),r&&(f.scale(1,-1),d*=-1,d-=c),f.translate(p,d)),f.drawImage(t,u,h,l,c,0,0,l,c),f.restore(),this):(this.ctx.drawImage(t,u,h,l,c,p,d,l,c),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var f;p=~~Math.round((e||0)-this.camera.x),d=~~Math.round((n||0)-this.camera.y);return s?((f=this.ctx).save(),o?(i&&(f.scale(-1,1),p*=-1,p-=t.height),r&&(f.scale(1,-1),d*=-1,d-=t.width),f.translate(p+t.height,d),f.rotate(y)):(i&&(f.scale(-1,1),p*=-1,p-=t.width),r&&(f.scale(1,-1),d*=-1,d-=t.height),f.translate(p,d)),f.drawImage(t,0,0),f.restore()):this.ctx.drawImage(t,p,d),this},i.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},i.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},i.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},i.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},i.prototype.rect=function(t,e,n,i){if(n<=1||i<=1){var r=this.ctx.fillStyle;return this.ctx.fillStyle=this.ctx.strokeStyle,this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~n,~~i),this.ctx.fillStyle=r,this}return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(n-1),~~(i-1)),this},i.prototype.rectf=function(t,e,n,i){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~n,~~i),this},i.prototype.rectfill=i.prototype.rectf,i.prototype._isTexture=!0,i.prototype.tilesheet=r(16*h,16*l)},{"../domUtils/createCanvas":17,"./index":13}],13:[function(t,e,n){"use strict";function i(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function r(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=i).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],i.prototype.ox=0,i.prototype.oy=0,i.setTileSize=function(){},i.prototype.setPalette=function(t){i.prototype.palette=t},i.prototype.setGlobalTilesheet=function(t){r(i.prototype,t)},i.prototype.setTilesheet=function(t){if(t)return r(this,t),this;delete this.tilesheet},i.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],14:[function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=t("./index.js"),h=3,l=5,r=i.prototype.setPalette;i.prototype.setPalette=function(t){r.call(this,t),i.prototype.textCharset=new i(128*h,l*t.length),function(t,e){for(var n=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],i=0;i<e.length;i++){t.fillStyle=e[i].string;for(var r=0;r<n.length;r++)for(var o=n[r],s=0;s<15;s++){var a=s%h,u=~~(s/h);1==(o>>s&1)&&t.fillRect(r*h+a,i*l+u,1,1)}}t.fillStyle=e[0].string}(i.prototype.textCharset.ctx,t)};var s=i.prototype.resize;i.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,s.call(this,t,e),this},i.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},i.prototype.textCharset=new i(128*h,l*i.prototype.palette.length),i.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},i.prototype.print=function(e,t,n){if("object"===o(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),n=~~Math.round(n-this.camera.y);for(var i=0;i<e.length;i++)this.ctx.drawImage(this.textCharset.canvas,h*e.charCodeAt(i),l*this._pen,h,l,t,n,h,l),t+=4;return this}for(i=0;i<e.length;i++){this._cursor.j>=this._textLine&&this.textScroll();var r=e.charCodeAt(i);10!==r&&13!==r?(this.ctx.drawImage(this.textCharset.canvas,h*r,l*this._pen,h,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,h,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},i.prototype.println=function(t){return this.print(t),this.print("\n"),this},i.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":13}],15:[function(t,e,n){"use strict";var i=t("../Texture"),r=t(".."),h=8,l=8;function c(t,e,n,i,r,o,s,a){this.x=~~t,this.y=~~e,this.sprite=~~n,this.flipH=!!i,this.flipV=!!r,this.flipR=!!o,this.flagA=!!s,this.flagB=!!a}function o(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=o).prototype._isTileMap=!0;var a,d,s={},u=[];o.getMap=function(t){return"string"==typeof t?s[t]:"number"==typeof t?u[t]:(console.error("Map does not exist",t),null)},o._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},o.loadBank=function(t){t=o._checkBankFormat(t),s={},u=[];for(var e=t.maps||[],n=0;n<e.length;n++)u.push((new o).load(e[n]))},o.setTileSize=function(t,e){h=~~t,l=~~e},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&s[this._name]&&s[this._name]===this&&delete s[this._name],(this._name=t)&&!s[t]&&(s[t]=this)}}),o.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var n=0;n<t;n++){this.items.push([]);for(var i=0;i<e;i++)this.items[n][i]=null}this.texture&&this.texture.resize(t*h,e*l)},o.prototype.resize=function(t,e){var n=this.items,i=Math.min(this.width,t),r=Math.min(this.height,e);this._init(t,e);for(var o=0;o<i;o++)for(var s=0;s<r;s++)this.items[o][s]=n[o][s];return this.redraw(),this},o.prototype.set=function(t,e,n,i,r,o,s,a){if(null==n)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var u=this.items[t][e]=new c(t,e,n,i,r,o,s,a);return this.texture&&(this.texture.ctx.clearRect(t*h,e*l,h,l),this.texture.sprite(u.sprite,u.x*h,u.y*l,u.flipH,u.flipV,u.flipR)),this}},o.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*h,e*l,h,l),this},o.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},o.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var n=this.items[t][e];n&&this.texture.sprite(n.sprite,n.x*h,n.y*l,n.flipH,n.flipV,n.flipR)}return this},o.prototype._prepareTexture=function(){this.texture=new i(this.width*h,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},o.prototype.release=function(){this.texture=null},o.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},o.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&(this.texture.setTilesheet(t),this.redraw()),this},o.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),n=r.assets||{},i=0;i<e.length;i++)if(!(n=n[e[i]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(n)},function(){for(var n="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",h={},t=0;t<n.length;t++)h[n[t]]=t;var l=n.length,c=l*l-1,p=Math.pow(2,13),o=c-p-1;function s(t){var e=t%l;return n[~~(t/l)]+n[e]}a=function(t){for(var e="",n=0,i=0;i<t.length;i++){var r=t[i];r===t[i+1]&&++n<o||(null===r&&(r=c),e+=s(r),n===o&&n--,0!==n&&(e+=s(p+n)),n=0)}return n===o&&n--,0!==n&&(e+=s(p+n)),e},d=function(t){for(var e=[],n=0;n<t.length;){var i=t[n++],r=t[n++],o=h[i]*l+h[r];if(o===c)e.push(null);else if(p<o)for(var s=o-p,a=e[e.length-1],u=0;u<s;u++)e.push(a);else e.push(o)}return e}}(),o.prototype.save=function(){for(var t=this.width,e=this.height,n=new Array(t*e),i=0;i<t;i++)for(var r=0;r<e;r++){var o=this.items[i][r];n[i+r*t]=o?o.sprite+(o.flipH<<8)+(o.flipV<<9)+(o.flipR<<10)+(o.flagA<<11)+(o.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(n)}},o.prototype.load=function(t){this.texture=null;var e=t.w,n=t.h;this._init(e,n),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var i=d(t.data),r=0;r<e;r++)for(var o=0;o<n;o++){var s=i[r+o*e];if(null!==s){var a=255&s,u=s>>8&1,h=s>>9&1,l=s>>10&1,c=s>>11&1,p=s>>12&1;this.set(r,o,a,u,h,l,c,p)}}return this},o.prototype.copy=function(t,e,n,i){t=t||0,e=e||0,null==n&&(n=this.width),null==i&&(i=this.height);var r=new o(n,i);return r.paste(this,-t,-e),r},o.prototype.paste=function(t,e,n,i){e=e||0,n=n||0;for(var r=Math.min(t.width,this.width-e),o=Math.min(t.height,this.height-n),s=Math.max(0,-e),a=Math.max(0,-n),u=s;u<r;u++)for(var h=a;h<o;h++){var l=t.items[u][h];if(l)this.set(u+e,h+n,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(i)continue;this.remove(u+e,h+n)}}return this},o.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},o.prototype.find=function(t,e,n){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===n&&(n=null);for(var i=[],r=0;r<this.width;r++)for(var o=0;o<this.height;o++){var s=this.items[r][o];if(s){var a=null===e||s.flagA===e,u=null===n||s.flagB===n;s.sprite===t&&a&&u&&i.push(s)}}return i},o.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var n=0;n<this.height;n++)null===this.items[e][n]&&t.push({x:e,y:n});return t}},{"..":19,"../Texture":13}],16:[function(t,e,n){"use strict";function d(t,e){var n=new Image;n.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},n.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},n.src=t}function f(t,e){var n=new Audio;function i(){e&&e(null,n),n.removeEventListener("canplaythrough",i),n.removeEventListener("error",r)}function r(){e&&e("snd:load"),n.removeEventListener("canplaythrough",i),n.removeEventListener("error",r)}n.preload=!0,n.loop=!1,n.addEventListener("canplaythrough",i),n.addEventListener("error",r),n.src=t,n.load()}n.loadData=function(t,e,n){var i=new XMLHttpRequest;i.responseType=e||"arraybuffer",i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status&&0!=~~i.status?n&&n("xhrError:"+i.status):n&&n(null,i.response)},i.open("GET",t,!0),i.send()},n.loadJson=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==~~n.readyState)return 200!=~~n.status?e("xhrError:"+n.status):e&&e(null,JSON.parse(n.response))},n.open("GET",t,!0),n.send()},n.loadImage=d,n.loadSound=f,n.preloadStaticAssets=function(i,r,o){var a=i.dat,s=i.img.length,u=s+i.snd.length,h=i.root,l=0,c=0;function p(){var n,t,e=l+c;o&&o(l,e,u,e/u),t=e<s?(n=i.img[e],d):(n=i.snd[e-s],f),c+=1,t(h+n,function(t,e){t||function(t,e){var n=t.split("/"),i=n.pop().split(".");i.pop(),i=i.join(".");for(var r=a,o=0,s=n.length;o<s;o++)r=r[n[o]];r[i]=e,n.push(i),e.name=i,e.path=n.join("/")}(n,e),(l+=1)+--c<u?p():0===c&&r(null,a)})}if(0===u)return r(null,a);for(var t=Math.min(5,u-1),e=0;e<=t;e++)p()}},{}],17:[function(t,e,n){"use strict";e.exports=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}},{}],18:[function(t,e,n){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],i=!(!navigator||!navigator.getGamepads),p=!1,d=.2;function r(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}r.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var e=c[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var f=[new r,new r,new r,new r,window],o=new r;var s=i?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var n=t[e],i=f[e];if(n){var r,o,s,a;i.available=!0,p&&(r=i.btn.right,o=i.btn.left,a=i.btn.down,s=i.btn.up);for(var u=0;u<c.length;u++){var h=c[u],l=n.buttons[u].pressed;i.btnp[h]=!i.btn[h]&&l,i.btnr[h]=i.btn[h]&&!l,i.btn[h]=l}i.x=n.axes[0],i.y=n.axes[1],i.z=n.axes[2],i.w=n.axes[3],i.lt=n.buttons[6].value,i.rt=n.buttons[7].value,p&&(i.btn.right=i.btn.right||i.x>d,i.btn.left=i.btn.left||i.x<-d,i.btn.down=i.btn.down||i.y>d,i.btn.up=i.btn.up||i.y<-d,i.btnp.right=i.btn.right&&!r,i.btnp.left=i.btn.left&&!o,i.btnp.down=i.btn.down&&!a,i.btnp.up=i.btn.up&&!s,i.btnr.right=!i.btn.right&&r,i.btnr.left=!i.btn.left&&o,i.btnr.down=!i.btn.down&&a,i.btnr.up=!i.btn.up&&s)}else i.available=!1}return f}:function(){return f};n.mapAnalogStickToDpad=function(t){p=!0,d=void 0===t?.3:t},n.update=function(){window.gamepads=s(),window.gamepad=function(){for(var t=0;t<c.length;t++){var e=c[t];o.btnp[e]=btnp[e]||f[0].btnp[e]||f[1].btnp[e]||f[2].btnp[e]||f[3].btnp[e],o.btnr[e]=btnr[e]||f[0].btnr[e]||f[1].btnr[e]||f[2].btnr[e]||f[3].btnr[e],o.btn[e]=btn[e]||f[0].btn[e]||f[1].btn[e]||f[2].btn[e]||f[3].btn[e]}return o.btn.up&&o.btn.down&&(o.btn.down=!1),o.btn.right&&o.btn.left&&(o.btn.left=!1),o}()}},{}],19:[function(t,e,n){"use strict";e.exports={}},{}],20:[function(t,e,n){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],21:[function(t,e,n){"use strict";var a,u,i=t(".."),r=i.settings,h=~~r.screen.pixelSize.width,l=~~r.screen.pixelSize.height,o=i.$screen.canvas,c=!0;if(r.screen.fullscreen){var s=function(){f=null;var t=o.getBoundingClientRect();h=t.width/p,l=t.height/d},p=r.screen.width,d=r.screen.height,f=null;window.onresize=function(){f&&window.clearTimeout(f),f=window.setTimeout(s,300)},s()}var y={x:0,y:0,pressed:!1},v=null,m=null,g=null,x=null,w=null,b=0,S=o.getBoundingClientRect();a=S.left,u=S.top;var _=r.touchEvent||{};_.disableContextMenu&&(o.oncontextmenu=function(){return!1}),_.hideMousePointer&&(o.style.cursor="none"),_.multiTouch&&(c=!1),o.addEventListener("mousedown",function(t){t.preventDefault(),window.focus(),y.pressed=!0,y.x=~~(t.layerX/h),y.y=~~(t.layerY/l),v&&v(y.x,y.y,0,t)}),o.addEventListener("mousemove",function(t){t.preventDefault(),y.x=~~(t.layerX/h),y.y=~~(t.layerY/l),m&&m(y.x,y.y,0,t)}),window.addEventListener("mouseup",function(t){t.preventDefault(),y.pressed&&(y.pressed=!1,y.x=~~(t.layerX/h),y.y=~~(t.layerY/l),g&&g(y.x,y.y,0,t))}),document.addEventListener("mouseleave",function(t){y.pressed&&(y.pressed=!1,x?x(0,t):g&&g(y.x,y.y,0,t))}),o.addEventListener("touchstart",function(t){if(t.preventDefault(),v){var e=t.changedTouches;if(c)return b=e[0].identifier,y.x=~~((i.clientX-a)/h),y.y=~~((i.clientY-u)/l),void v(y.x,y.y,i.identifier,i);for(var n=0;n<e.length;n++){var i=e[n],r=~~((i.clientX-a)/h),o=~~((i.clientY-u)/l);v(r,o,i.identifier,i)}}}),o.addEventListener("touchmove",function(t){if(t.preventDefault(),m)for(var e=t.changedTouches,n=0;n<e.length;n++){var i=e[n],r=i.identifier;if(c){if(r!==b)continue;return y.x=~~((i.clientX-a)/h),y.y=~~((i.clientY-u)/l),void m(y.x,y.y,i.identifier,i)}var o=~~((i.clientX-a)/h),s=~~((i.clientY-u)/l);m(o,s,i.identifier,i)}}),o.addEventListener("touchend",function(t){if(t.preventDefault(),onEnd)for(var e=t.changedTouches,n=0;n<e.length;n++){var i=e[n],r=i.identifier;if(c){if(r!==b)continue;return y.x=~~((i.clientX-a)/h),y.y=~~((i.clientY-u)/l),void onEnd(y.x,y.y,i.identifier,i)}var o=~~((i.clientX-a)/h),s=~~((i.clientY-u)/l);onEnd(o,s,i.identifier,i)}}),o.addEventListener("touchcancel",function(t){if(t.preventDefault(),x)for(var e=t.changedTouches,n=0;n<e.length;n++){var i=e[n],r=i.identifier;if(c){if(r!==b)continue;return void x(i.identifier,i)}x(i.identifier,i)}}),o.addEventListener("wheel",function(t){t.preventDefault();var e=t.wheelDeltaY;0!==e&&w&&w(e,t)}),n.onPress=function(t){v=t},n.onRelease=function(t){g=t},n.onMove=function(t){m=t},n.onCancel=function(t){x=t},n.onScroll=function(t){w=t},n.pointer=y},{"..":19}],22:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MobCharacter=n.PlayerCharacter=void 0;var i=t("./input.js");function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(o){return function(){var t,e,n,i=u(o);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=u(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return e=this,!(n=t)||"object"!==s(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):n}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}var p={S:2,W:4,E:6,N:8},d=[0,5,11,13,27,28,29],f=function(){function i(t,e,n){h(this,i),this.x=8*e,this.y=8*n,this.dir=p.S,this.movable=!1,this.reached=!1,this.sprites=t,this.counter=0}return c(i,[{key:"isInTile",value:function(){return this.x%8==0&&this.y%8==0}},{key:"isFrontOf",value:function(t,e){var n=t.toward(),i=t.x/8+n.x,r=t.y/8+n.y;return 13==e.items[i][r].sprite&&(i+=n.x,r+=n.y),i==this.x/8&&r==this.y/8}},{key:"turnTo",value:function(t){var e=t.x/8-this.x/8,n=t.y/8-this.y/8;0==e&&1<=n&&(this.dir=p.S),e<=-1&&0==n&&(this.dir=p.W),1<=e&&0==n&&(this.dir=p.E),0==e&&n<=-1&&(this.dir=p.N)}},{key:"toward",value:function(){var t=0,e=0;return this.dir==p.S&&(e=1),this.dir==p.W&&(t=-1),this.dir==p.E&&(t=1),this.dir==p.N&&(e=-1),{x:t,y:e}}},{key:"getMapPos",value:function(){var t=this.x/8,e=this.y/8;return this.isInTile()||(this.dir==p.E&&t++,this.dir==p.S&&e++),{x:t,y:e}}},{key:"canPass",value:function(t,e){var n=this.toward(),i=this.x/8+n.x,r=this.y/8+n.y;return!(i<0||i>t.width-1||r<0||r>t.height-1)&&(!d.includes(t.items[i][r].sprite)&&!(0<e[i][r]))}},{key:"tick",value:function(t,e){this.counter++,this.counter%=30,this.isInTile()&&this.direction()&&this.canPass(t,e)&&(this.movable=!0)}},{key:"move",value:function(t){if(this.reached=!1,this.movable){var e=this.toward();if(this.isInTile()){var n=this.getMapPos(),i=t[n.x][n.y];t[n.x+e.x][n.y+e.y]=i,t[n.x][n.y]=0}this.x+=e.x,this.y+=e.y,this.isInTile()&&(this.reached=!0,this.movable=!1)}}},{key:"draw",value:function(){var t,e=this.counter<15?0:1,n=!1;this.dir==p.S&&(t=this.sprites[0]),this.dir==p.W&&(t=this.sprites[2],n=!0),this.dir==p.E&&(t=this.sprites[2]),this.dir==p.N&&(t=this.sprites[1]),sprite(t+e,this.x,this.y,n)}}]),i}(),y=function(){r(e,f);var t=a(e);function e(){return h(this,e),t.apply(this,arguments)}return c(e,[{key:"direction",value:function(){if(i.input.pressRight())this.dir=p.E;else if(i.input.pressLeft())this.dir=p.W;else if(i.input.pressUp())this.dir=p.N;else{if(!i.input.pressDown())return!1;this.dir=p.S}return!0}}]),e}();n.PlayerCharacter=y;var v=function(){r(i,f);var n=a(i);function i(t){var e;return h(this,i),(e=n.call(this,t.sprites,t.x,t.y)).message=t.message,t.move||(e.move=function(){}),e}return c(i,[{key:"direction",value:function(){if(0==this.counter){var t=random(16);for(var e in p)if(t==p[e])return this.dir=t,!0}return!1}},{key:"draw",value:function(){var t=this.counter<15,e=this.sprites[0];sprite(e,this.x,this.y,t)}}]),i}();n.MobCharacter=v},{"./input.js":24}],23:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initMap=O,n.stateWalk=function(t,e,n){b.tick(_,A),b.move(A);var i,r=w(S);try{for(r.s();!(i=r.n()).done;){var o=i.value;o.tick(_,A),o.move(A)}}catch(t){r.e(t)}finally{r.f()}if(b.reached){var s,a=b.x/8,u=b.y/8,h=w(E.place);try{for(h.s();!(s=h.n()).done;){var l=s.value;if(l.x==a&&l.y==u){var c=l.effect;return O(c.map,c.x,c.y),"WALK"}}}catch(t){h.e(t)}finally{h.f()}var p=_.items[a][u].sprite;if(6==p&&(t.hp--,T=!0),10==p&&(t.hp-=15,T=!0),t.hp<=0)return t.hp=0,e.addMessage("YOU DIED."),"DIED";var d=E.encount;if(0!=d.length){var f=random(16);if(d.length>f){var y=d[f];return e.addMonster(n[y]),e.addMessage(y+" APPEARED."),"ENCOUNT"}}}if(b.isInTile()){if(x.input.pressOkOnce()){var v,m=w(S);try{for(m.s();!(v=m.n()).done;){var g=v.value;if(g.isInTile()&&g.isFrontOf(b,_))return g.turnTo(b),e.addMessage(g.message,b),"TALK"}}catch(t){m.e(t)}finally{m.f()}}if(x.input.pressCancelOnce())return e.addStatus(t),e.addCommand(),"COMMAND"}return"WALK"},n.drawField=function(t){var e={x:b.x-60,y:b.y-60},n=8*(_.width-16),i=8*(_.height-16);e.x=e.x<0?0:e.x>n?n:e.x,e.y=e.y<0?0:e.y>i?i:e.y,camera(e.x,e.y),draw(_,0,0);var r,o=w(S);try{for(o.s();!(r=o.n()).done;){r.value.draw()}}catch(t){o.e(t)}finally{o.f()}b.draw(),T&&(paper(9),cls(),T=!1);t.draw(e)};var x=t("./input.js"),a=t("./character.js");function w(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,o=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var h={castle2F:{mobs:[{sprites:[221],x:6,y:6,move:!1,message:"WHAT DOES IT MEAN TO DIE?"},{sprites:[220],x:7,y:9,move:!0,message:"THE PRINCESS WAS KIDNAPPED BY\n THE DRAGON KING."}],place:[{x:11,y:11,effect:{map:"castle",x:5,y:5}}],encount:[]},castle:{mobs:[{sprites:[220],x:7,y:14,move:!1,message:"WELCOME TO THE CASTLE."},{sprites:[237],x:11,y:13,move:!1,message:"MAY THE HERO HAVE LIGHT."}],place:[{x:5,y:5,effect:{map:"castle2F",x:11,y:11}},{x:6,y:15,effect:{map:"world",x:15,y:12}},{x:5,y:0,effect:{map:"world",x:15,y:12}},{x:6,y:0,effect:{map:"world",x:15,y:12}},{x:7,y:0,effect:{map:"world",x:15,y:12}}],encount:[]},town:{mobs:[{sprites:[219],x:6,y:6,move:!0,message:"EXCHANGE FOR MY PORTPIA AND \n YOUR DRAGON QUEST."},{sprites:[220],x:6,y:7,move:!0,message:"DRAGON KING IS OVER THE SEA."},{sprites:[235],x:7,y:6,move:!0,message:"PUFF PUFF IS 50 GOLDS."},{sprites:[236],x:2,y:2,move:!1,message:"MAY I HELP YOU?"},{sprites:[253],x:14,y:1,move:!1,message:"I GOT PEE ON MY LEG!"},{sprites:[237],x:12,y:3,move:!1,message:"I WILL BREAK YOUR CURSE."}],place:[{x:0,y:7,effect:{map:"world",x:7,y:7}},{x:0,y:8,effect:{map:"world",x:7,y:7}},{x:8,y:0,effect:{map:"world",x:7,y:7}},{x:15,y:7,effect:{map:"world",x:7,y:7}},{x:15,y:8,effect:{map:"world",x:7,y:7}}],encount:[]},cave:{mobs:[],place:[{x:1,y:1,effect:{map:"world",x:24,y:6}},{x:14,y:14,effect:{map:"caveB2",x:14,y:14}},{x:6,y:6,effect:{map:"caveB2",x:6,y:6}},{x:9,y:9,effect:{map:"caveB2",x:9,y:9}}],encount:[]},caveB2:{mobs:[],place:[{x:14,y:14,effect:{map:"cave",x:14,y:14}},{x:6,y:6,effect:{map:"cave",x:6,y:6}},{x:9,y:9,effect:{map:"cave",x:9,y:9}}],encount:[]},world:{mobs:[],place:[{x:7,y:7,effect:{map:"town",x:0,y:7}},{x:15,y:12,effect:{map:"castle",x:6,y:15}},{x:24,y:6,effect:{map:"cave",x:1,y:1}}],encount:["SLIME","DRAKEE","GHOST"]}},b=new a.PlayerCharacter([222,238,254],0,0),S=void 0,_=void 0,E=void 0,A=void 0,T=!1;function O(t,e,n){b.x=8*e,b.y=8*n,_=getMap(t),E=h[t],S=Array.from(E.mobs,function(t){return new a.MobCharacter(t)}),A=new Array(_.width);for(var i=0;i<_.width;i++)A[i]=new Array(_.height).fill(0);var r,o=w(S);try{for(o.s();!(r=o.n()).done;){var s=r.value.getMapPos();A[s.x][s.y]=1}}catch(t){o.e(t)}finally{o.f()}A[e][n]=2}},{"./character.js":22,"./input.js":24}],24:[function(t,e,n){"use strict";var i,r=(i=t("../node_modules/pixelbox/pointerEvents/index.js"))&&i.__esModule?i:{default:i};r.default.onPress(function(){}),r.default.onRelease(function(){}),r.default.onMove(function(){}),r.default.onCancel(function(){}),r.default.onScroll(function(){});var o={x:20,y:84,width:8,height:8},s={x:20,y:116,width:8,height:8},a={x:36,y:100,width:8,height:8},u={x:4,y:100,width:8,height:8},h={x:108,y:92,width:8,height:8},l={x:92,y:108,width:8,height:8};function c(t,e,n){return n.x<=t&&t<n.x+n.width&&n.y<=e&&e<n.y+n.height}function p(t){return t.nowPressed&&!t.oldPressed}var d={pressRight:function(){var t=r.default.pointer;return btn.right||t.pressed&&c(t.x,t.y,a)},pressRightOnce:function(){var t=r.default.pointer;return btnp.right||p(t)&&c(t.x,t.y,a)},pressLeft:function(){var t=r.default.pointer;return btn.left||t.pressed&&c(t.x,t.y,u)},pressLeftOnce:function(){var t=r.default.pointer;return btnp.left||p(t)&&c(t.x,t.y,u)},pressUp:function(){var t=r.default.pointer;return btn.up||t.pressed&&c(t.x,t.y,o)},pressUpOnce:function(){var t=r.default.pointer;return btnp.up||p(t)&&c(t.x,t.y,o)},pressDown:function(){var t=r.default.pointer;return btn.down||t.pressed&&c(t.x,t.y,s)},pressDownOnce:function(){var t=r.default.pointer;return btnp.down||p(t)&&c(t.x,t.y,s)},pressOk:function(){var t=r.default.pointer;return btn.A||t.pressed&&c(t.x,t.y,h)},pressOkOnce:function(){var t=r.default.pointer;return btnp.A||p(t)&&c(t.x,t.y,h)},pressCancel:function(){var t=r.default.pointer;return btn.B||t.pressed&&c(t.x,t.y,l)},pressCancelOnce:function(){var t=r.default.pointer;return btnp.B||p(t)&&c(t.x,t.y,l)},onUpdate:function(){var t=r.default.pointer;t.oldPressed=t.nowPressed,t.nowPressed=t.pressed},drawButton:function(t){sprite(t,o.x,o.y),sprite(t,s.x,s.y),sprite(t,a.x,a.y),sprite(t,u.x,u.y),sprite(t,h.x,h.y),sprite(t,l.x,l.y)}};n.input=d},{"../node_modules/pixelbox/pointerEvents/index.js":21}],25:[function(t,e,n){"use strict";var s=t("./input.js"),i=t("./window.js"),r=t("./field.js");function o(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,o=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var u={"COPPER SWORD":{type:"WEAPON",attack:12},"STEEL SWORD":{type:"WEAPON",attack:25},"LEATHER ARMOR":{type:"ARMOR",defense:8},"IRON ARMOR":{type:"ARMOR",defense:20},"LEATHER SHIELD":{type:"SHIELD",defense:8},"MITHRIL SHIELD":{type:"SHIELD",defense:40},HERB:{type:"TOOL",effect:{type:"HEAL",value:30}}},h={HEAL:{mp:3,field:!0,battle:!0,effect:{type:"HEAL",value:30}},FIRE:{mp:2,field:!1,battle:!0,effect:{type:"DAMAGE",value:20}},SLEEP:{mp:2,field:!1,battle:!0,effect:{type:"SLEEP"}},SILENT:{mp:2,field:!1,battle:!0,effect:{type:"SILENT"}},ESCAPE:{mp:8,field:!0,battle:!1,effect:{type:"ESCAPE"}},RETURN:{mp:8,field:!0,battle:!0,effect:{type:"RETURN"}},HOLY:{mp:2,field:!0,battle:!1,effect:{type:"HOLY"}},HEALMORE:{mp:10,field:!0,battle:!0,effect:{type:"HEAL",value:100}},EXPLODE:{mp:6,field:!1,battle:!0,effect:{type:"DAMAGE",value:80}}},l={SLIME:{hp:3,maxhp:3,mp:0,maxmp:0,str:4,agi:4,atk:4,def:2,lv:1,exp:1,money:1,action:["ATTACK"],sprite:240},DRAKEE:{hp:5,maxhp:5,mp:0,maxmp:0,str:4,agi:4,atk:5,def:4,lv:2,exp:2,money:3,action:["ATTACK"],sprite:241},GHOST:{hp:7,maxhp:7,mp:0,maxmp:0,str:4,agi:4,atk:5,def:4,lv:3,exp:4,money:5,action:["ATTACK"],sprite:242}},c={name:"ROTO",hp:10,maxhp:10,mp:0,maxmp:0,lv:1,exp:0,str:8,agi:4,atk:8,def:2,money:100,item:[{id:"COPPER SWORD",equip:!0},{id:"STEEL SWORD",equip:!1},{id:"LEATHER ARMOR",equip:!0},{id:"IRON ARMOR",equip:!1},{id:"LEATHER SHIELD",equip:!0},{id:"MITHRIL SHIELD",equip:!1},{id:"HERB",equip:!1}],spell:[{id:"HEAL",learned:!0},{id:"FIRE",learned:!0},{id:"SLEEP",learned:!0},{id:"SILENT",learned:!0},{id:"ESCAPE",learned:!0},{id:"RETURN",learned:!1},{id:"HOLY",learned:!1},{id:"HEALMORE",learned:!1},{id:"EXPLODE",learned:!1}]},p=new i.WindowManager;function d(t){t.atk=t.str,t.def=t.agi/2;var e,n=o(t.item);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.equip){var r=u[i.id];"WEAPON"==r.type&&(t.atk+=r.attack),"ARMOR"!=r.type&&"SHIELD"!=r.type||(t.def+=r.defense)}}}catch(t){n.e(t)}finally{n.f()}}d(c),(0,r.initMap)("town",0,7);var f={WALK:function(){var t=(0,r.stateWalk)(c,p,l);y=f[t]},TALK:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.WALK,p.windows=[])},COMMAND:function(){var t=p.windows[p.windows.length-1];if(s.input.pressOkOnce()){var e=t.cursor,n=t.choice[e.y][e.x];if("ITEM"==n&&(y=f.ITEM,p.addFieldItem(c.item)),"SPELL"==n){var i=c.spell.filter(function(t){return t.learned&&h[t.id].field});y=f.SPELL,p.addFieldSpell(i)}"STATUS"==n&&(y=f.STATUS,p.addStatusDetail(c))}else s.input.pressCancelOnce()?(y=f.WALK,p.windows=[]):s.input.pressRightOnce()?t.cursorRight():s.input.pressLeftOnce()?t.cursorLeft():s.input.pressUpOnce()?t.cursorUp():s.input.pressDownOnce()&&t.cursorDown()},ITEM:function(){var t=p.windows[p.windows.length-1];if(s.input.pressOkOnce()){var e,n=t.cursor,i=c.item[n].id,r=u[i];if(["WEAPON","ARMOR","SHIELD"].includes(r.type)){if(c.item[n].equip)e="YOU REMOVED A\n "+i+".",c.item[n].equip=!1;else{for(var o in c.item)u[c.item[o].id].type==r.type&&(c.item[o].equip=!1);e="YOU HAVE EQUIPPED A\n "+i+".",c.item[n].equip=!0}d(c)}"TOOL"==r.type&&(e="YOU HAVE USED A\n "+i+".","HEAL"==r.effect.type&&(e+="\n YOUR WOUND HAS HEALED.",c.hp+=r.effect.value,c.hp>c.maxhp&&(c.hp=c.maxhp),c.item.splice(n,1),c.item.length==n&&t.cursor--)),y=f.ITEM_EFFECT,p.addMessage(e)}else s.input.pressCancelOnce()?(y=f.COMMAND,p.windows.pop()):s.input.pressUpOnce()?t.cursorUp():s.input.pressDownOnce()&&t.cursorDown()},ITEM_EFFECT:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.ITEM,p.windows.pop())},STATUS:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.COMMAND,p.windows.pop())},DIED:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(c.hp=c.maxhp,c.mp=c.maxmp,y=f.WALK,p.windows.pop(),(0,r.initMap)("castle2F",6,7))},SPELL:function(){var t=p.windows[p.windows.length-1];if(s.input.pressOkOnce()){var e=t.cursor,n=t.choice[e].id,i=h[n],r="YOU CAST "+n+"!";i.mp>c.mp?r+="\n BUT MP IS NOT ENOUGH.":"HEAL"==i.effect.type&&(r+="\n YOUR WOUND HAS HEALED.",c.hp+=i.effect.value,c.hp>c.maxhp&&(c.hp=c.maxhp),c.mp-=i.mp),y=f.SPELL_EFFECT,p.addMessage(r)}else s.input.pressCancelOnce()?(y=f.COMMAND,p.windows.pop()):s.input.pressUpOnce()?t.cursorUp():s.input.pressDownOnce()&&t.cursorDown()},SPELL_EFFECT:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.SPELL,p.windows.pop())},ENCOUNT:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.BATTLE_COMMAND,p.windows.pop(),p.addStatus(c),p.addBattleCommand())},BATTLE_COMMAND:function(){var t=p.windows[p.windows.length-1];if(s.input.pressOkOnce()){var e=t.cursor;"RUN"==t.choice[e.y][e.x]&&(y=f.RUN,p.addMessage("YOU RAN AWAY."))}else s.input.pressRightOnce()?t.cursorRight():s.input.pressLeftOnce()?t.cursorLeft():s.input.pressUpOnce()?t.cursorUp():s.input.pressDownOnce()&&t.cursorDown()},RUN:function(){(s.input.pressOkOnce()||s.input.pressCancelOnce())&&(y=f.WALK,p.windows=[])},FIGHT:function(){}},y=f.WALK;n.update=function(){s.input.onUpdate(),y(),(0,r.drawField)(p),s.input.drawButton(106)}},{"./field.js":23,"./input.js":24,"./window.js":26}],26:[function(t,e,n){"use strict";function i(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,o=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(o){return function(){var t,e,n,i=h(o);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=h(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return e=this,!(n=t)||"object"!==s(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):n}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}Object.defineProperty(n,"__esModule",{value:!0}),n.WindowManager=void 0;var d=function(){function t(){l(this,t)}return p(t,[{key:"padSpace",value:function(t,e){var n=e.toString().length;return" ".repeat(t-n)+e}},{key:"drawFrame",value:function(t,e,n,i){paper(0),rectf(t,e,n,i),pen(1),rect(t+1,e+1,n-2,i-2)}}]),t}(),f=function(){o(r,d);var i=u(r);function r(t,e){var n;return l(this,r),(n=i.call(this)).message=t,n.player=e,n}return p(r,[{key:"draw",value:function(t){var e=null==this.player||this.player.y-t.y<64?96:0;this.drawFrame(t.x,t.y+e,128,32),locate(1,1+e/6),println(this.message)}}]),r}(),y=function(){o(i,d);var n=u(i);function i(t){var e;return l(this,i),(e=n.call(this)).status=t,e}return p(i,[{key:"drawTexts",value:function(t,e,n){for(var i=0;i<t.length;i++)locate(1+e/4,i+n/6),print(t[i])}},{key:"draw",value:function(t){this.drawFrame(t.x+96,t.y+96,24,28),rectf(t.x+96+3,t.y+96,18,4);var e=[this.status.name,"H"+this.padSpace(3,this.status.hp),"M"+this.padSpace(3,this.status.mp),"LV"+this.padSpace(2,this.status.lv)];this.drawTexts(e,96,96)}}]),i}(),v=function(){o(n,y);var e=u(n);function n(t){return l(this,n),e.call(this,t)}return p(n,[{key:"draw",value:function(t){this.drawFrame(t.x+32,t.y+24,56,60),rectf(t.x+32+15,t.y+24,26,4);var e=["   STATUS","STRENGTH:"+this.padSpace(3,this.status.str)," AGILITY:"+this.padSpace(3,this.status.agi),"  MAX HP:"+this.padSpace(3,this.status.maxhp),"  MAX MP:"+this.padSpace(3,this.status.maxmp),"  ATTACK:"+this.padSpace(3,this.status.atk)," DEFENSE:"+this.padSpace(3,this.status.def),"EXP:   "+this.padSpace(5,this.status.exp),"GOLD:  "+this.padSpace(5,this.status.money)];this.drawTexts(e,32,24)}}]),n}(),m=function(){o(n,d);var e=u(n);function n(){var t;return l(this,n),(t=e.call(this)).cursor={x:0,y:0},t.choice=[["ITEM","SPELL"],["EQUIP","STATUS"]],t}return p(n,[{key:"cursorRight",value:function(){this.cursor.x++,this.cursor.x%=this.choice[0].length}},{key:"cursorLeft",value:function(){this.cursor.x+=this.choice[0].length-1,this.cursor.x%=this.choice[0].length}},{key:"cursorDown",value:function(){this.cursor.y++,this.cursor.y%=this.choice.length}},{key:"cursorUp",value:function(){this.cursor.y+=this.choice.length-1,this.cursor.y%=this.choice.length}},{key:"draw",value:function(t){this.drawFrame(t.x+8,t.y+12,68,24),rectf(t.x+8+19,t.y+12,30,4),locate(7,2),print("COMMAND");for(var e=0;e<this.choice.length;e++)for(var n=this.choice[e],i=0;i<n.length;i++){var r=4+8*i,o=3+e;locate(r,o),print(this.choice[e][i]),this.cursor.x==i&&this.cursor.y==e&&(locate(r-1,o),print(">"))}}}]),n}(),g=function(){o(n,m);var e=u(n);function n(){var t;return l(this,n),(t=e.call(this)).choice=[["FIGHT","SPELL"],["RUN","ITEM"]],t}return n}(),x=function(){o(i,d);var n=u(i);function i(t){var e;return l(this,i),(e=n.call(this)).cursor=0,e.choice=t,e}return p(i,[{key:"cursorDown",value:function(){this.cursor++,this.cursor%=this.choice.length}},{key:"cursorUp",value:function(){this.cursor+=this.choice.length-1,this.cursor%=this.choice.length}},{key:"draw",value:function(t){var e=6*(this.choice.length+2);this.drawFrame(t.x+0,t.y+18,72,e),rectf(t.x+0+15,t.y+18,18,4),locate(4,3),print("ITEM");for(var n=0;n<this.choice.length;n++){var i=4+n;locate(3,i),print(this.choice[n].id),this.cursor==n&&(locate(2,i),print(">")),this.choice[n].equip&&(locate(1,i),print("E"))}}}]),i}(),w=function(){o(i,d);var n=u(i);function i(t){var e;return l(this,i),(e=n.call(this)).cursor=0,e.choice=t,e}return p(i,[{key:"cursorDown",value:function(){this.cursor++,this.cursor%=this.choice.length}},{key:"cursorUp",value:function(){this.cursor+=this.choice.length-1,this.cursor%=this.choice.length}},{key:"draw",value:function(t){var e=6*(this.choice.length+2);this.drawFrame(t.x+32,t.y+18,52,e),rectf(t.x+32+15,t.y+18,22,4),locate(12,3),print("SPELL");for(var n=0;n<this.choice.length;n++){var i=4+n;locate(10,i),print(this.choice[n].id),this.cursor==n&&(locate(9,i),print(">"))}}}]),i}(),b=function(){o(i,d);var n=u(i);function i(t){var e;return l(this,i),(e=n.call(this)).monster=t,e}return p(i,[{key:"draw",value:function(t){this.drawFrame(t.x+36,t.y+36,56,56),sprite(this.monster.sprite,t.x+36+24,t.y+36+24)}}]),i}(),S=function(){function t(){l(this,t),this.windows=[]}return p(t,[{key:"draw",value:function(t){var e,n=i(this.windows);try{for(n.s();!(e=n.n()).done;){e.value.draw(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"addMessage",value:function(t,e){this.windows.push(new f(t,e))}},{key:"addStatus",value:function(t){this.windows.push(new y(t))}},{key:"addStatusDetail",value:function(t){this.windows.push(new v(t))}},{key:"addCommand",value:function(){this.windows.push(new m)}},{key:"addBattleCommand",value:function(){this.windows.push(new g)}},{key:"addFieldItem",value:function(t){this.windows.push(new x(t))}},{key:"addFieldSpell",value:function(t){this.windows.push(new w(t))}},{key:"addMonster",value:function(t){this.windows.push(new b(t))}}]),t}();n.WindowManager=S},{}],27:[function(f,t,e){"use strict";var n,i,c=f("."),r={dat:{palette:null,tilesheet:null,tilesheet_org:null,bleeper:{_type:"Bleeper program",v:1,s:[{n:"",i:[20,0,127,0],s:"#############DU#BU#B##B##B##B#%XU%[U%_U%_#%_#%_#%aU%$U%'U%*U%-U%5U%PU"}]},maps:{_type:"maps",maps:[{w:32,h:32,name:"world",sheet:"tilesheet",data:"##|~#$##|~#$##|~#$##|~#$##|~#$##|~#$##|~#$|6##|1#$|1##|/#$|:###$|,###$|3##|-#$|:###$|6##|-#$|:###$|,#%|1#$|~##|,#$|/#%|-#$|2###$|,#%|-#(|-#%|-#$|,##|,#$|~#%|/#$|1###$|/#(#<#(#$|/##|,#$|~#%|,#+#%|,#$|1#,#$|7##|,#$|~#%|/#$|1###$|7##|,#$|/#%|~#$|0##|,#$|0#)|-#$|~##|,#$|?#)|/#$|~##|,#$|>#)|/#$|/##|,#$|8#*#$|/#)|-#$|1##|,#$|H##|,#$|E#(|,#$##|,#$|F#(#$##|,#$|0#(|,#$#(|,#$|3#&|~#$#&#$|,#(#$##|,#$|,#(|~#$|0##|-#$|~#&|2#$#(#$##|9#$|/#&|3#$#(#$##|,#$###(#$|2#'|~#$#'#$#&|3#$#(#$##|,#$|,#(#$|0#'|3#&|3#$#(#$##|,#$|,#(#$|~#'|4#$|,#&|2#$#(#$##|-#$#(#$|,#'|3#$|0#&|1#$#(#$##|-#$#(#$|-#'|/#$|:#(|,#$##|-#$#(|,#$|8#%|,#$|/#(|,#$|-##|,#$|-#(|-#$|4#%|~#$|-#(|-#$|~##|,#$|/#(|-#$#(#$#(#$|,#(#$|0#(|-#$|0##|,#$|:#(#$|,#(|-#$|2##|-#$|C##|-#$##|/#$|:##|-#$|,###$###$|-##|1#$|8###$|-##|/#$|,##|K"},{w:16,h:16,name:"town",sheet:"tilesheet",data:"#~|2#/#~|2#/|-#~#$|-#/#$|0#~|,#/|-#~#$|-#/#$|,#~|-#$#~|-#0#~|,#$|-#/#$|,#~#/#~#$#~|,#$#/#$#?#$|-#/#$|,#~#/#~#$#~|,#$#/#$|~#%#/#%#$|,#/#$|,#~|,#$#/#$|-#%|,#/#%|,#$#/#$|,#~#/|J#~#$|-#/#$|~#/##|0#~#$|-#/#>#$|-#/#,#$|~###~|~#/#~|-#$##|,#$|~###~#/|,#@#/#0#/#~#$###~|,#0#~|,###~#/|,#~#/#~#/#~#$###~#/|-#~###~#B#/#~#/#~#/#~#$###~|/###~|2##|2"},{w:16,h:16,name:"castle",sheet:"",data:"#~|/#$#%#$#~|1#$#~#/|-#~#$|-#~#/|-#~#/#~#$#~#/#~#/#~|,#/#~|,#/#~#/#~#0#~#$#~#/|5#~#$|-#~|-#/#~|0#@#~|,#/#~#$#~#B#~#/#~#1#/|,#~#/|/#~#$#~#/#@#/#~|,#/#~|,#/|/#~#$#~#B#~#/#~#%#/#%#~#/#~|,#/#~|,#$#~|-#/#~#$#/#$#~|-#/|-#~#$#~#/|3#~#-|-#~#$#~#/|/###/|-#~#/|-#~#$#~|-#/|1#~|/#$#~#/|-#~#/|-#~#/#~#/#~##|,#$#~###/|,#~|,#/#~|,#/#0#/#~##|,#$#~##|,#/#~#/|-#~#/#~#/#~##|,#$#~|0#/#~|0##|,#2"},{w:16,h:16,name:"castle2F",sheet:"",data:"#=|^#~|4#=|0#~#/|2#~#=|0#~#/#0|0#/#~#=|0#~#/#0#/#0|,#/#0#/#~#=|0#~#/|2#~#=|0#~#/|2#~#=|0#~#/|2#~#=|0#~|-#/#~|0#=|0#~#/|1#2#~#=|0#~|4#=|^"},{w:16,h:16,name:"cave",sheet:"",data:"#~|;#1#/#~#/|-#~#/|1#~|,#/|~#~#/#~#/#~|/#/#~|1#/#~#/#~#/|/#~|,#/|2#~#/|,#~|/#/#~|3#/|~#~|,#/#~#B#/#~#2#/|-#~|~#/#~|,#/#~#/|,#~#/|~#~#B#/#~#/#~|,#/#~|,#/#~#/|~#~#/|,#~#/#~|,#/#~#/|,#~#/|-#2#~#/|~#~|,#/#~#/#~|7#/#~#/|6#~|,#/#~|/#/#~#/#~|-#/|,#~|,#/#~#/|-#~#/#~#/|-#~#/|,#~|,#/|-#~#/|-#~#/|,#B#~#/#2#~|;"},{w:16,h:16,name:"caveB2",sheet:"",data:"#~|;#/|8#~|,#/#~|6#/#~|,#/#~#B|,#~#/|1#~#/#~|,#/#~#/|,#~#/#~|/#/#~#/#~|,#/#~#/|,#~#/#~#/|/#~#/#~|,#/#~#/|,#~#1#~#/#~|/#/#~|,#/#~#/#~|~#/|~#~#/|,#~|,#/#~#/#~#/|~#~|,#/#~#/|,#~|,#/#~#/#~|/#1#~#/#~#/|,#~|,#/#~#/|1#~#/#~#B|,#~|,#/#~|3#/#~|/#/#~#/|6#~|,#/#~#/#~|7#/|7#1#~|;"}]},patatracker:{_type:"Patatracker album",t:8,v:0,a:[],i:{1:[{n:""}],2:[{n:""}],3:[{n:""}],4:[{n:""}],5:[{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}],6:[{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}],7:[{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}]},s:[{n:"untitled",a:"",i:"",b:130,l:32,s:4,g:[],h:16,o:0,e:[0,0,0,0],t:[{y:1,p:[],s:[-1]},{y:1,p:[],s:[-1]},{y:2,p:[],s:[-1]},{y:3,p:[],s:[-1]},{y:6,p:[],s:[-1]},{y:0,p:[],s:[]},{y:0,p:[],s:[]},{y:0,p:[],s:[]}]}]}},root:"assets/",img:["palette.png","tilesheet.png","tilesheet_org.png"],snd:[],settings:{name:"pixelboxtest",version:"2.0.2",appid:"xc6jgFuEgUTYNND9",screen:{fullscreen:!1,resizable:!1,keepAspectRatio:!1,width:128,height:128,pixelSize:{width:4,height:4}},tileSize:{width:8,height:8},palette:{name:"db16",file:"palette",colors:["#140c1c","#deeed6","#d2aa99","#346524","#4e4a4e","#757161","#8595a1","#6daa2c","#854c30","#d04648","#d27d2c","#dad45e","#442434","#30346d","#597dce","#6dc2ca"]},controls:{up:38,down:40,left:37,right:39,A:90,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#140C1C","#DEEED6"],custom:""}}},y=c.settings=r.settings,o=f("./assetLoader");function s(){n.resume(),document.body.removeEventListener("mousedown",s),document.body.removeEventListener("touchstart",s)}c.inherits=f("./inherits"),c.setFullScreen=function(){},n=null,i=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return n||(n=new i,document.body.addEventListener("mousedown",s),document.body.addEventListener("touchstart",s),n)};var a=f("audio-manager"),u=c.audioManager=new a(["sfx"]);u.settings.audioPath="audio/",u.settings.defaultFade=.3,u.init(),u.setVolume("sfx",1),c.sfx=function(t,e,n,i){u.playSound("sfx",t,e,n,i)},c.music=function(t,e,n,i){t?u.playLoopSound("sfx",t,e,0,0,n,i):u.stopLoopSound("sfx")};var h=c.btn={},l=c.btnp={},p=c.btnr={},d={},v=[],m=0;function g(){for(var t=0;t<m;t++)l[v[t]]=!1,p[v[t]]=!1}function x(t,e){var n=d[t];n&&(e&&!h[n]&&(l[n]=!0),!e&&h[n]&&(p[n]=!0),h[n]=e)}!function(){var t=y.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)d[t[e]]=e,h[e]=!1,l[e]=!1,p[e]=!1,v.push(e);m=v.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||x(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),x(t.keyCode,!1)}),c.chr$=function(t){return String.fromCharCode(t)},c.clamp=function(t,e,n){return Math.max(e,Math.min(n,t))},c.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var w=f("./Texture"),b=f("./TileMap");f("./Texture/canvas2D"),f("./Texture/textCanvas2D");var S=y.tileSize.width,_=y.tileSize.height;w.setTileSize(S,_),b.setTileSize(S,_),c.texture=function(t){var e=new w(t.width,t.height);return e.clear().draw(t,0,0),e},c.tilesheet=function(t){return w.prototype.setGlobalTilesheet(t)};var E=function(){var t=y.screen,u=t.width,h=t.height,l=t.pixelSize,e=c.$screen=new w(u,h),n=e.canvas,i=n.style;if(document.body.appendChild(n),t.fullscreen)if(t.keepAspectRatio){var r=function(){var t=window.innerWidth,e=window.innerHeight,n=u*l.width,i=h*l.height,r=Math.min(t/n,e/i),o=n*r,s=i*r,a=c.$screen.canvas.style;a.width=o+"px",a.height=s+"px",a.left=(t-o)/2+"px",a.top=(e-s)/2+"px"};addEventListener("resize",r),r()}else i.width=i.height="100%";else i.width=u*l.width+"px",i.height=h*l.height+"px";return e}();c.cls=function(){return E.cls()},c.sprite=function(t,e,n,i,r,o){return E.sprite(t,e,n,i,r,o)},c.draw=function(t,e,n,i,r,o){return E.draw(t,e,n,i,r,o)},c.rect=function(t,e,n,i){return E.rect(t,e,n,i)},c.rectf=function(t,e,n,i){return E.rectf(t,e,n,i)},c.camera=function(t,e){return E.setCamera(t,e)},c.pen=function(t){return E.pen(t)},c.paper=function(t){return E.paper(t)},c.locate=function(t,e){return E.locate(t,e)},c.print=function(t,e,n){return E.print(t,e,n)},c.println=function(t){return E.println(t)},c.getMap=b.getMap,c.rectfill=c.rectf,E.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var A=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var T=~~(y.screen.width/2),O=~~(y.screen.width/4),L=~~(y.screen.height/2);var $=["#000","#FFF"],M=y.loader&&y.loader.colors||y.loaderColors||$;Array.isArray(M)||(M=$);var I=f("./Color");E.setPalette([(new I).fromString(M[0]),(new I).fromString(M[1])]),E.paper(0).cls().paper(1).pen(1).rect(T-O-2,L-4,2*O+4,8),o.preloadStaticAssets(r,function(t,d){if(E.paper(0).pen(1).cls(),t)return console.error(t),void print(t);for(var e in c.assets=d,c)window[e]=c[e];(function(){var t=f("./Color"),e=y.palette;if(e.file){for(var n=e.file.split("/"),i=d;i&&n.length;)i=i[n.shift()];if(!i)return;var r=i.width,o=i.height,s=i.x||0,a=i.y||0;i._isSprite&&(i=i.img);var u=f("./domUtils/createCanvas")(r,o).getContext("2d");u.drawImage(i,s,a,r,o,0,0,r,o);for(var h=u.getImageData(0,0,r,o).data,l=[],c=0;c<h.length;c+=4)h[c+3]<=1||l.push((new t).fromPixel(h,c));E.setPalette(l)}else{var p;for(p=e.colors?e.colors:e,l=[],c=0;c<p.length;c++)l.push((new t).fromString(p[c]));E.setPalette(l)}})(),d.tilesheet&&c.tilesheet(d.tilesheet),b.loadBank(d.maps);var n=f("./gamepad"),i=y.gamepad||{};i.analogToDpad&&n.mapAnalogStickToDpad(i.deadZone);var r=f("../../src/main.js");r.update&&(g(),function t(){window.frameId+=1,n.update(),r.update(),g(),A(t)}())},function(t,e,n,i){E.rect(T-O-2,L-4,2*O+4,8).rectf(T-O,L-2,~~(i*O*2),4)})},{".":19,"../../src/main.js":25,"./Color":11,"./Texture":13,"./Texture/canvas2D":12,"./Texture/textCanvas2D":14,"./TileMap":15,"./assetLoader":16,"./domUtils/createCanvas":17,"./gamepad":18,"./inherits":20,"audio-manager":5}]},{},[27]);